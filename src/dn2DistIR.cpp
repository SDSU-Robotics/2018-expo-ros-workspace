/*************************************************************************************
 * 
 * dn2DistIR.c
 * 
 * Author: Calvin
 * Date: 2/4/2018
 * 
 * Description: Function that uses a lookup table to convert a DN value to cm.
 *  The lookup table was created by using MATLAB to analyze experimental data
 *  points created by measuring the DN value at 5 cm increments. The function will
 *  return values only within the distance range as specified in the datasheet for
 *  the IR sensor.
 *  
 *  Datasheet link: https://www.sparkfun.com/datasheets/Sensors/Infrared/gp2y0a02yk_e.pdf
 *  
 * **********************************************************************************/

// Min and max distances in cm according to the datasheet
#define MIN_DIST 20
#define MAX_DIST 150

const float dn2Dist[] = { 648.740000,637.058527,625.602600,614.367823,603.349883,592.544553,581.947688,571.555224,
561.363176,551.367637,541.564776,531.950838,522.522140,513.275071,504.206091,495.311729,
486.588581,478.033311,469.642647,461.413381,453.342368,445.426524,437.662824,430.048306,
422.580061,415.255240,408.071049,401.024747,394.113649,387.335120,380.686578,374.165490,
367.769375,361.495798,355.342372,349.306758,343.386660,337.579830,331.884061,326.297191,
320.817099,315.441707,310.168975,304.996906,299.923540,294.946954,290.065266,285.276628,
280.579229,275.971294,271.451080,267.016882,262.667025,258.399868,254.213803,250.107251,
246.078666,242.126530,238.249358,234.445690,230.714098,227.053179,223.461559,219.937891,
216.480853,213.089150,209.761512,206.496693,203.293473,200.150654,197.067062,194.041546,
191.072978,188.160251,185.302280,182.498002,179.746374,177.046373,174.396996,171.797261,
169.246203,166.742877,164.286356,161.875733,159.510116,157.188631,154.910423,152.674651,
150.480493,148.327140,146.213802,144.139702,142.104079,140.106188,138.145296,136.220686,
134.331656,132.477516,130.657588,128.871212,127.117736,125.396523,123.706948,122.048400,
120.420276,118.821988,117.252959,115.712621,114.200421,112.715813,111.258263,109.827250,
108.422258,107.042785,105.688338,104.358433,103.052596,101.770361,100.511273,99.274885,
98.060758,96.868462,95.697576,94.547687,93.418389,92.309286,91.219988,90.150113,
89.099285,88.067140,87.053315,86.057458,85.079224,84.118272,83.174271,82.246892,
81.335818,80.440734,79.561332,78.697311,77.848375,77.014234,76.194605,75.389207,
74.597769,73.820021,73.055702,72.304553,71.566322,70.840761,70.127627,69.426682,
68.737693,68.060431,67.394670,66.740192,66.096780,65.464222,64.842311,64.230844,
63.629620,63.038445,62.457127,61.885476,61.323310,60.770447,60.226709,59.691923,
59.165919,58.648529,58.139590,57.638940,57.146422,56.661881,56.185167,55.716130,
55.254624,54.800507,54.353640,53.913883,53.481103,53.055168,52.635948,52.223316,
51.817148,51.417322,51.023717,50.636217,50.254706,49.879072,49.509203,49.144992,
48.786332,48.433118,48.085249,47.742624,47.405144,47.072713,46.745236,46.422621,
46.104777,45.791615,45.483046,45.178986,44.879350,44.584056,44.293023,44.006171,
43.723423,43.444702,43.169934,42.899046,42.631965,42.368622,42.108946,41.852870,
41.600328,41.351254,41.105584,40.863257,40.624209,40.388382,40.155715,39.926152,
39.699634,39.476106,39.255515,39.037805,38.822924,38.610821,38.401446,38.194748,
37.990679,37.789192,37.590239,37.393775,37.199754,37.008133,36.818869,36.631918,
36.447240,36.264793,36.084538,35.906435,35.730446,35.556533,35.384658,35.214787,
35.046883,34.880911,34.716836,34.554627,34.394248,34.235669,34.078857,33.923782,
33.770413,33.618720,33.468673,33.320244,33.173406,33.028129,32.884387,32.742154,
32.601403,32.462109,32.324246,32.187791,32.052718,31.919004,31.786627,31.655562,
31.525789,31.397284,31.270027,31.143996,31.019171,30.895531,30.773056,30.651728,
30.531526,30.412432,30.294427,30.177495,30.061616,29.946773,29.832949,29.720129,
29.608294,29.497429,29.387519,29.278547,29.170499,29.063360,28.957114,28.851749,
28.747248,28.643600,28.540790,28.438804,28.337631,28.237256,28.137669,28.038855,
27.940803,27.843502,27.746939,27.651104,27.555984,27.461570,27.367850,27.274813,
27.182450,27.090749,26.999702,26.909298,26.819528,26.730382,26.641851,26.553926,
26.466598,26.379858,26.293698,26.208109,26.123082,26.038611,25.954686,25.871301,
25.788446,25.706116,25.624301,25.542996,25.462193,25.381885,25.302065,25.222727,
25.143863,25.065468,24.987534,24.910057,24.833028,24.756444,24.680297,24.604582,
24.529293,24.454424,24.379971,24.305927,24.232288,24.159047,24.086201,24.013744,
23.941671,23.869977,23.798658,23.727709,23.657125,23.586901,23.517035,23.447520,
23.378353,23.309530,23.241046,23.172898,23.105082,23.037593,22.970428,22.903583,
22.837054,22.770839,22.704932,22.639332,22.574034,22.509034,22.444331,22.379920,
22.315798,22.251962,22.188409,22.125136,22.062140,21.999418,21.936968,21.874785,
21.812869,21.751215,21.689821,21.628685,21.567804,21.507175,21.446796,21.386665,
21.326779,21.267135,21.207731,21.148566,21.089636,21.030940,20.972475,20.914240,
20.856231,20.798448,20.740888,20.683548,20.626427,20.569524,20.512836,20.456360,
20.400097,20.344043,20.288196,20.232556,20.177120,20.121887,20.066854,20.012021,
19.957386,19.902946,19.848701,19.794649,19.740788,19.687118,19.633635,19.580340,
19.527230,19.474305,19.421562,19.369000,19.316619,19.264416,19.212391,19.160542,
19.108867,19.057367,19.006038,18.954881,18.903894,18.853076,18.802426,18.751942,
18.701623,18.651469,18.601478,18.551649,18.501981,18.452473,18.403125,18.353934,
18.304900,18.256023,18.207300,18.158732,18.110317,18.062053,18.013942,17.965980,
17.918168,17.870505,17.822990,17.775621,17.728399,17.681322,17.634389,17.587599,
17.540953,17.494449,17.448085,17.401862,17.355779,17.309835,17.264029,17.218361,
17.172829,17.127433,17.082173,17.037047,16.992055,16.947196,16.902470,16.857876,
16.813413,16.769081,16.724879,16.680806,16.636862,16.593045,16.549357,16.505795,
16.462360,16.419050,16.375865,16.332805,16.289869,16.247056,16.204367,16.161799,
16.119353,16.077029,16.034825,15.992741,15.950777,15.908932,15.867206,15.825598,
15.784107,15.742733,15.701476,15.660336,15.619310,15.578400,15.537605,15.496924,
15.456357,15.415902,15.375561,15.335333,15.295216,15.255210,15.215316,15.175533,
15.135859,15.096296,15.056841,15.017496,14.978259,14.939131,14.900110,14.861196,
14.822390,14.783689,14.745095,14.706607,14.668224,14.629946,14.591773,14.553704,
14.515739,14.477877,14.440118,14.402462,14.364909,14.327457,14.290107,14.252858,
14.215711,14.178664,14.141717,14.104870,14.068123,14.031474,13.994925,13.958475,
13.922122,13.885868,13.849711,13.813651,13.777688,13.741822,13.706052,13.670379,
13.634800,13.599318,13.563930,13.528637,13.493438,13.458334,13.423323,13.388406,
13.353582,13.318851,13.284213,13.249667,13.215213,13.180851,13.146581,13.112401,
13.078313,13.044315,13.010407,12.976590,12.942862,12.909224,12.875675,12.842215,
12.808844,12.775561,12.742367,12.709260,12.676241,12.643310,12.610465,12.577707,
12.545036,12.512451,12.479953,12.447540,12.415213,12.382971,12.350814,12.318742,
12.286754,12.254851,12.223032,12.191296,12.159645,12.128076,12.096591,12.065188,
12.033868,12.002631,11.971476,11.940402,11.909410,11.878500,11.847671,11.816923,
11.786255,11.755668,11.725162,11.694735,11.664388,11.634121,11.603933,11.573825,
11.543795,11.513844,11.483971,11.454177,11.424460,11.394822,11.365261,11.335777,
11.306371,11.277042,11.247789,11.218613,11.189513,11.160489,11.131542,11.102669,
11.073873,11.045151,11.016505,10.987933,10.959437,10.931014,10.902666,10.874392,
10.846191,10.818064,10.790011,10.762031,10.734124,10.706290,10.678528,10.650839,
10.623222,10.595677,10.568203,10.540802,10.513472,10.486213,10.459025,10.431908,
10.404862,10.377886,10.350980,10.324145,10.297379,10.270684,10.244057,10.217500,
10.191013,10.164594,10.138244,10.111962,10.085749,10.059605,10.033528,10.007519,
9.981578,9.955704,9.929898,9.904159,9.878486,9.852881,9.827342,9.801870,
9.776464,9.751123,9.725849,9.700641,9.675498,9.650420,9.625408,9.600461,
9.575578,9.550760,9.526007,9.501318,9.476693,9.452132,9.427635,9.403202,
9.378832,9.354526,9.330282,9.306102,9.281984,9.257930,9.233937,9.210007,
9.186139,9.162333,9.138589,9.114907,9.091286,9.067726,9.044228,9.020790,
8.997414,8.974098,8.950842,8.927647,8.904513,8.881438,8.858423,8.835468,
8.812573,8.789737,8.766960,8.744242,8.721584,8.698984,8.676443,8.653960,
8.631536,8.609169,8.586861,8.564611,8.542419,8.520284,8.498206,8.476186,
8.454223,8.432317,8.410468,8.388675,8.366939,8.345259,8.323636,8.302069,
8.280557,8.259102,8.237702,8.216357,8.195068,8.173835,8.152656,8.131532,
8.110463,8.089449,8.068489,8.047583,8.026732,8.005935,7.985191,7.964502,
7.943866,7.923284,7.902755,7.882279,7.861856,7.841487,7.821170,7.800906,
7.780694,7.760535,7.740428,7.720373,7.700370,7.680419,7.660520,7.640672,
7.620876,7.601131,7.581438,7.561795,7.542203,7.522663,7.503172,7.483733,
7.464343,7.445004,7.425715,7.406476,7.387287,7.368148,7.349058,7.330018,
7.311027,7.292086,7.273193,7.254349,7.235555,7.216809,7.198111,7.179462,
7.160862,7.142309,7.123805,7.105349,7.086940,7.068579,7.050266,7.032000,
7.013782,6.995611,6.977487,6.959409,6.941379,6.923396,6.905459,6.887568,
6.869724,6.851926,6.834175,6.816469,6.798809,6.781195,6.763626,6.746104,
6.728626,6.711194,6.693807,6.676465,6.659168,6.641916,6.624708,6.607545,
6.590427,6.573353,6.556323,6.539337,6.522396,6.505498,6.488644,6.471834,
6.455067,6.438344,6.421664,6.405027,6.388433,6.371883,6.355375,6.338910,
6.322488,6.306108,6.289771,6.273476,6.257223,6.241012,6.224844,6.208717,
6.192632,6.176589,6.160587,6.144627,6.128708,6.112830,6.096994,6.081198,
6.065444,6.049730,6.034057,6.018425,6.002833,5.987281,5.971770,5.956299,
5.940868,5.925477,5.910126,5.894815,5.879543,5.864311,5.849119,5.833966,
5.818852,5.803777,5.788741,5.773744,5.758786,5.743867,5.728987,5.714145,
5.699341,5.684576,5.669849,5.655160,5.640510,5.625897,5.611322,5.596785,
5.582286,5.567824,5.553399,5.539012,5.524663,5.510350,5.496075,5.481836,
5.467635,5.453470,5.439342,5.425250,5.411195,5.397176,5.383194,5.369248,
5.355338,5.341464,5.327626,5.313824,5.300058,5.286327,5.272632,5.258973,
5.245348,5.231760,5.218206,5.204687,5.191204,5.177755,5.164341,5.150962,
5.137618,5.124308,5.111033,5.097792,5.084585,5.071413,5.058274,5.045170,
5.032100,5.019063,5.006061,4.993092,4.980156,4.967255,4.954386,4.941551,
4.928749,4.915981,4.903245,4.890542,4.877873,4.865236,4.852632,4.840060,
4.827521,4.815015,4.802541,4.790099,4.777690,4.765312,4.752967,4.740654,
4.728372,4.716123,4.703905,4.691719,4.679564,4.667441,4.655349,4.643289,
4.631260,4.619262,4.607295,4.595359,4.583454,4.571580,4.559737,4.547924,
4.536142,4.524391,4.512669,4.500979,4.489318,4.477688,4.466088,4.454518,
4.442978,4.431468,4.419987,4.408537,4.397116,4.385724,4.374362,4.363030,
4.351727,4.340453,4.329209,4.317993,4.306807,4.295649,4.284521,4.273421,
4.262350,4.251308,4.240294,4.229309,4.218353,4.207424,4.196525,4.185653,
4.174809,4.163994,4.153206,4.142447,4.131715,4.121012,4.110336,4.099687 };

float dn2DistIR( int dnVal ) {
  float distance;
  distance = dn2Dist[dnVal];
  if (distance < MIN_DIST) distance = MIN_DIST;
  if (distance > MAX_DIST) distance = MAX_DIST;
  return distance;
}

